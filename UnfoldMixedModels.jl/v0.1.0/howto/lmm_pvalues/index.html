<!DOCTYPE html><HTML lang="en"><head><script charset="utf-8" src="../../../../assets/default/multidoc_injector.js" type="text/javascript"></script><script charset="utf-8" type="text/javascript">window.MULTIDOCUMENTER_ROOT_PATH = '/UnfoldDocs/'</script><script charset="utf-8" src="../../../../assets/default/flexsearch.bundle.js" type="text/javascript"></script><script charset="utf-8" src="../../../../assets/default/flexsearch_integration.js" type="text/javascript"></script><meta charset="UTF-8"/><meta content="width=device-width, initial-scale=1.0" name="viewport"/><title>P-values for mixedModels · UnfoldMixedModels.jl</title><meta content="P-values for mixedModels · UnfoldMixedModels.jl" name="title"/><meta content="P-values for mixedModels · UnfoldMixedModels.jl" property="og:title"/><meta content="P-values for mixedModels · UnfoldMixedModels.jl" property="twitter:title"/><meta content="Documentation for UnfoldMixedModels.jl." name="description"/><meta content="Documentation for UnfoldMixedModels.jl." property="og:description"/><meta content="Documentation for UnfoldMixedModels.jl." property="twitter:description"/><meta content="https://unfoldtoolbox.github.io/UnfoldMixedModels.jl/howto/lmm_pvalues/" property="og:url"/><meta content="https://unfoldtoolbox.github.io/UnfoldMixedModels.jl/howto/lmm_pvalues/" property="twitter:url"/><link href="https://unfoldtoolbox.github.io/UnfoldDocs/UnfoldMixedModels.jl/stable/howto/lmm_pvalues/" rel="canonical"/><script data-outdated-warner="" src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script data-main="../../assets/documenter.js" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" data-theme-name="catppuccin-mocha" href="../../assets/themes/catppuccin-mocha.css" rel="stylesheet" type="text/css"/><link class="docs-theme-link" data-theme-name="catppuccin-macchiato" href="../../assets/themes/catppuccin-macchiato.css" rel="stylesheet" type="text/css"/><link class="docs-theme-link" data-theme-name="catppuccin-frappe" href="../../assets/themes/catppuccin-frappe.css" rel="stylesheet" type="text/css"/><link class="docs-theme-link" data-theme-name="catppuccin-latte" href="../../assets/themes/catppuccin-latte.css" rel="stylesheet" type="text/css"/><link class="docs-theme-link" data-theme-name="documenter-dark" data-theme-primary-dark="" href="../../assets/themes/documenter-dark.css" rel="stylesheet" type="text/css"/><link class="docs-theme-link" data-theme-name="documenter-light" data-theme-primary="" href="../../assets/themes/documenter-light.css" rel="stylesheet" type="text/css"/><script src="../../assets/themeswap.js"></script><link href="../../../../assets/default/multidoc.css" rel="stylesheet" type="text/css"/><link href="../../../../assets/default/flexsearch.css" rel="stylesheet" type="text/css"/><link href="../../../../assets/style.css" rel="stylesheet" type="text/css"/></head><body><nav id="multi-page-nav"><div class="hidden-on-mobile" id="nav-items"><a class="nav-link nav-item" href="../../../../main/"><div class="homebutton">Home</div></a><a class="nav-link nav-item" href="../../../../Unfold.jl/"><div class="headertitle"> Analysis </div><br/> Unfold<span style="color:#ccc;"></span>.jl</a><a class="nav-link active nav-item" href="../../../"><div class="headertitle"> LMM </div><br/> Unfold<span style="color:#197BDD;">MixedModels</span>.jl</a><a class="nav-link nav-item" href="../../../../UnfoldMakie.jl/"><div class="headertitle"> Visualization </div><br/> Unfold<span style="color:#3AAA35;">Makie</span>.jl</a><a class="nav-link nav-item" href="../../../../UnfoldSim.jl/"><div class="headertitle"> Simulation </div><br/> Unfold<span style="color:#E6007E;">Sim</span>.jl</a><a class="nav-link nav-item" href="../../../../UnfoldBIDS.jl/"><div class="headertitle"> Pipeline </div><br/> Unfold<span style="color:#FEC700;">BIDS</span>.jl</a><a class="nav-link nav-item" href="../../../../UnfoldStats.jl/"><div class="headertitle"> Statistics </div><br/> Unfold<span style="color:#E30613;">Stats</span>.jl</a><a class="nav-link nav-item" href="../../../../UnfoldDecode.jl/"><div class="headertitle"> Decoding </div><br/> Unfold<span style="color:#009BA4;">Decode</span>.jl</a><div class="nav-dropdown"><button class="nav-item dropdown-label">Related Tools</button><ul class="nav-dropdown-container"><a class="nav-link nav-item" href="../../../../ClusterDepth.jl/"><div class="headertitle">Multiple Comparisons with ClusterDepth.jl</div></a></ul></div><div class="search nav-item"><input id="search-input" placeholder="Search everywhere..."/><ul class="suggestions hidden" id="search-result-container"></ul><div class="search-keybinding">/</div></div></div><button id="multidoc-toggler"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg></button></nav><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">UnfoldMixedModels.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">UnfoldMixedModels</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/lmm_mu/">lmmERP (mass univariate)</a></li><li><a class="tocitem" href="../../tutorials/lmm_overlap/">lmmERP (overlap correction)</a></li></ul></li><li><span class="tocitem">HowTo</span><ul><li class="is-active"><a class="tocitem" href="">P-values for mixedModels</a><ul class="internal"><li><a class="tocitem" href="#lmm_pvalues"><span>How To get P-Values for Mass-Univariate LMM</span></a></li><li><a class="tocitem" href="#Likelihood-ratio"><span>Likelihood ratio</span></a></li><li><a class="tocitem" href="#Walds-T-Test"><span>Walds T-Test</span></a></li><li><a class="tocitem" href="#Comparison-of-methods"><span>Comparison of methods</span></a></li></ul></li></ul></li><li><span class="tocitem">Explanations</span></li><li><span class="tocitem">Reference</span><ul><li><a class="tocitem" href="../../references/types/">API: Types</a></li><li><a class="tocitem" href="../../references/functions/">API: Functions</a></li></ul></li><li><span class="tocitem">Contributing</span><ul><li><a class="tocitem" href="../../90-contributing/">Contributing guidelines</a></li></ul></li><li><span class="tocitem">Developer Guide</span><ul><li><a class="tocitem" href="../../91-developer/">Developer documentation</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" href="#" id="documenter-sidebar-button"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">HowTo</a></li><li class="is-active"><a href="">P-values for mixedModels</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="">P-values for mixedModels</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/unfoldtoolbox/UnfoldMixedModels.jl/blob/main/docs/src/howto/lmm_pvalues.md#" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" href="#" id="documenter-settings-button" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" href="javascript:;" id="documenter-article-toggle-button" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h2 id="lmm_pvalues"><a class="docs-heading-anchor" href="#lmm_pvalues">How To get P-Values for Mass-Univariate LMM</a><a id="lmm_pvalues-1"></a><a class="docs-heading-anchor-permalink" href="#lmm_pvalues" title="Permalink"></a></h2><p>There are currently two ways to obtain p-values for LMMs: Wald's t-test and likelihood ratio tests (mass univariate only).</p><h3 id="Setup"><a class="docs-heading-anchor" href="#Setup">Setup</a><a id="Setup-1"></a><a class="docs-heading-anchor-permalink" href="#Setup" title="Permalink"></a></h3><pre><code class="language-julia hljs">using UnfoldMixedModels # we require to load MixedModels to load the PackageExtension
using DataFrames
using UnfoldSim
using CairoMakie
data_epoch, evts =
    UnfoldSim.predef_2x2(; n_items = 52, n_subjects = 40, return_epoched = true)
data_epoch = reshape(data_epoch, size(data_epoch, 1), :) #
times = range(0, 1, length = size(data_epoch, 1))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">0.0:0.010101010101010102:1.0</code></pre><h3 id="Define-f0-and-f1-and-fit"><a class="docs-heading-anchor" href="#Define-f0-and-f1-and-fit">Define f0 &amp; f1 and fit</a><a id="Define-f0-and-f1-and-fit-1"></a><a class="docs-heading-anchor-permalink" href="#Define-f0-and-f1-and-fit" title="Permalink"></a></h3><pre><code class="language-julia hljs">f0 = @formula 0 ~ 1 + A + (1 + A | subject);
f1 = @formula 0 ~ 1 + A + B + (1 + A | subject); # could also differ in random effects

m0 = fit(UnfoldModel,[Any=&gt;(f0,times)],evts,data_epoch);
m1 = fit(UnfoldModel,[Any=&gt;(f1,times)],evts,data_epoch);</code></pre><h2 id="Likelihood-ratio"><a class="docs-heading-anchor" href="#Likelihood-ratio">Likelihood ratio</a><a id="Likelihood-ratio-1"></a><a class="docs-heading-anchor-permalink" href="#Likelihood-ratio" title="Permalink"></a></h2><pre><code class="language-julia hljs">uf_lrt = likelihoodratiotest(data_epoch, m0, m1)
uf_lrt[1]</code></pre><table><tbody><tr><th align="left"></th><th align="right">model-dof</th><th align="right">deviance</th><th align="right">χ²</th><th align="right">χ²-dof</th><th align="left">P(&gt;χ²)</th></tr><tr><td align="left">�[38;2;144;202;249m1�[39m �[38;2;239;83;80m+�[39m A �[38;2;239;83;80m+�[39m (�[38;2;144;202;249m1�[39m �[38;2;239;83;80m+�[39m A �[38;2;239;83;80m|�[39m subject)</td><td align="right">6</td><td align="right">8012</td><td align="right"></td><td align="right"></td><td align="left"></td></tr><tr><td align="left">�[38;2;144;202;249m1�[39m �[38;2;239;83;80m+�[39m A �[38;2;239;83;80m+�[39m B �[38;2;239;83;80m+�[39m (�[38;2;144;202;249m1�[39m �[38;2;239;83;80m+�[39m A �[38;2;239;83;80m|�[39m subject)</td><td align="right">7</td><td align="right">8011</td><td align="right">1</td><td align="right">1</td><td align="left">0.3996</td></tr></tbody></table><p>As you can see, we have some likelihood ratio outcomes, exciting!</p><h3 id="Extract-p-values"><a class="docs-heading-anchor" href="#Extract-p-values">Extract p-values</a><a id="Extract-p-values-1"></a><a class="docs-heading-anchor-permalink" href="#Extract-p-values" title="Permalink"></a></h3><pre><code class="language-julia hljs">pvalues(uf_lrt)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">100-element Vector{Vector{Float64}}:
 [0.39964251754876706]
 [0.4019640858609401]
 [0.4074237173863722]
 [0.4070454519554564]
 [0.42228971014118033]
 [0.483155056260971]
 [0.6339437552710293]
 [NaN]
 [NaN]
 [NaN]
 ⋮
 [0.34292883003473407]
 [0.33515969561309156]
 [0.33325396532570495]
 [0.3428036624385943]
 [0.3567742512609538]
 [0.37049189795207205]
 [0.38051461402659575]
 [0.3883891630406846]
 [0.39851721772119286]</code></pre><p>We have extracted the p-values and now need to make them usable.     The solution can be found in the documentation under <code>?pvalues</code>.</p><pre><code class="language-julia hljs">pvals_lrt = vcat(pvalues(uf_lrt)...)
nchan = 1
ntime = length(times)
reshape(pvals_lrt, ntime, nchan)' # note the last transpose via ' !</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1×100 adjoint(::Matrix{Float64}) with eltype Float64:
 0.399643  0.401964  0.407424  0.407045  …  0.380515  0.388389  0.398517</code></pre><p>Perfecto, these are the LRT p-values of a model <code>condA</code> vs. <code>condA+condB</code> with same random effect structure.</p><h2 id="Walds-T-Test"><a class="docs-heading-anchor" href="#Walds-T-Test">Walds T-Test</a><a id="Walds-T-Test-1"></a><a class="docs-heading-anchor-permalink" href="#Walds-T-Test" title="Permalink"></a></h2><p>This method is easier to calculate but has limitations in accuracy and scope. It may also be less accurate due to the liberal estimation of degrees of freedom. Testing is limited in this case, as random effects cannot be tested and only single predictors can be used, which may not be appropriate for spline effects. It is important to note that this discussion is beyond the scope of this LMM package.</p><pre><code class="language-julia hljs">res = coeftable(m1)
# only fixed effects: what is not in a ranef group is a fixef.
res = res[isnothing.(res.group), :]
# calculate t-value
res[:, :tvalue] = res.estimate ./ res.stderror</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">300-element Vector{Float64}:
  4.446708326696426
  4.437580860011641
  4.446435058073349
  4.492672997803976
  4.494599457419684
  4.4880483252027075
  4.439652303422133
  4.45518635490581
  4.623068236549389
  4.663764726700654
  ⋮
  0.5870708293447756
  0.43759939804174963
  0.2172917074185397
  0.025591530320948425
 -0.11195974844949615
 -0.28040792854804225
 -0.22668554132390997
 -0.2646530795209725
 -0.3492299276363734</code></pre><p>We obtained Walds t, but how to translate them to a p-value?</p><p>Determining the necessary degrees of freedom for the t-distribution is a complex issue with much debate surrounding it. One approach is to use the number of subjects as an upper bound for the p-value (your df will be between <span>$n_{subject}$</span> and <span>$\sum{n_{trials}}$</span>).</p><pre><code class="language-julia hljs">df = length(unique(evts.subject))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">40</code></pre><p>Plug it into the t-distribution.</p><pre><code class="language-julia hljs">using Distributions
res.pvalue = pdf.(TDist(df),res.tvalue)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">300-element Vector{Float64}:
 0.00010520592926163251
 0.00010817494439425095
 0.00010529365405567558
 9.142141916777313e-5
 9.088393516836884e-5
 9.272440215982806e-5
 0.00010749405443829126
 0.00010251943544603832
 6.122445474960627e-5
 5.398423858898151e-5
 ⋮
 0.33251660178615255
 0.3594809847897533
 0.38698410798874533
 0.39632387743397085
 0.39391857391788004
 0.38081351375847516
 0.38615884540577883
 0.3824900521283194
 0.37247026276880874</code></pre><h2 id="Comparison-of-methods"><a class="docs-heading-anchor" href="#Comparison-of-methods">Comparison of methods</a><a id="Comparison-of-methods-1"></a><a class="docs-heading-anchor-permalink" href="#Comparison-of-methods" title="Permalink"></a></h2><p>Cool! Let's compare both methods of p-value calculation!</p><pre><code class="language-julia hljs">df = DataFrame(:walds =&gt; res[res.coefname.=="B: b_tiny", :pvalue], :lrt =&gt; pvals_lrt)
f = Figure()

scatter(f[1,1],times,res[res.coefname .== "B: b_tiny",:estimate],axis=(;xlabel="time",title="coef: B:b_tiny"))
scatter(f[1,2],df.walds,df.lrt,axis=(;title="walds-t pvalue",ylabel="LRT pvalue"))
scatter(f[2,1],times,df.walds,axis=(;title="walds-t pvalue",xlabel="time"))
scatter(f[2,2],times,df.lrt,axis=(;title="lrt pvalue",xlabel="time"))

f</code></pre><img alt="Example block output" src="9949f295.png"/><p>Look pretty similar! Note that the Walds-T is typically too liberal (LRT also, but to a lesser exted). Best is to use the forthcoming MixedModelsPermutations.jl or go the route via R and use KenwardRoger (data not yet published)</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../tutorials/lmm_overlap/">« lmmERP (overlap correction)</a><a class="docs-footer-nextpage" href="../../references/types/">API: Types »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label></p><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div><p></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Tuesday 21 January 2025 14:29">Tuesday 21 January 2025</span>. Using Julia version 1.11.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></HTML>